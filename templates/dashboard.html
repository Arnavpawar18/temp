<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Parking System - AI Powered</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .navbar { background: rgba(255,255,255,0.95); box-shadow: 0 2px 20px rgba(0,0,0,0.1); padding: 15px 0; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .navbar .container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .navbar .logo { font-size: 24px; font-weight: bold; color: #667eea; display: flex; align-items: center; gap: 10px; }
        .navbar .nav-links { display: flex; gap: 30px; }
        .navbar .nav-links a { color: #333; text-decoration: none; font-weight: 500; transition: color 0.3s; }
        .navbar .nav-links a:hover { color: #667eea; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
        .hero { background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; }
        .hero h1 { color: #667eea; font-size: 42px; margin-bottom: 10px; }
        .hero p { color: #666; font-size: 18px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h3 { color: #666; font-size: 14px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .stat-card .number { font-size: 42px; font-weight: bold; color: #667eea; }
        .slots { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .slot { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; transition: all 0.3s; font-weight: 600; }
        .slot:hover { transform: scale(1.05); }
        .slot.occupied { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .slot.available { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .slot h3 { margin-bottom: 10px; }
        .booking-section { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .booking-section h2 { color: #667eea; margin-bottom: 25px; font-size: 28px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #666; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; transition: border 0.3s; }
        .form-group input:focus { outline: none; border-color: #667eea; }
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 14px 40px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: transform 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102,126,234,0.4); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .message { padding: 15px; border-radius: 5px; margin-top: 15px; }
        .message.success { background: #d4edda; color: #155724; }
        .message.error { background: #f8d7da; color: #721c24; }
        .parked-cars { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-top: 30px; }
        .parked-cars h2 { color: #667eea; margin-bottom: 25px; font-size: 28px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; }
        h2 { margin-bottom: 20px; color: #667eea; font-size: 24px; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <span style="font-size: 28px;">üÖøÔ∏è</span>
                <span>Smart Parking System</span>
            </div>
            <div class="nav-links">
                <a href="/">Dashboard</a>
                <a href="/about">About</a>
                <a href="#booking">Book Slot</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="hero">
            <h1>üÖøÔ∏è Smart Parking System</h1>
            <p>AI-Powered Number Plate Recognition & Automated Parking Management</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <h3>Total Slots</h3>
                <div class="number" id="totalSlots">4</div>
            </div>
            <div class="stat-card">
                <h3>Available</h3>
                <div class="number" style="color: #4caf50;" id="availableSlots">-</div>
            </div>
            <div class="stat-card">
                <h3>Occupied</h3>
                <div class="number" style="color: #ff5252;" id="occupiedSlots">-</div>
            </div>
        </div>

        <h2 style="margin-bottom: 15px; color: white; text-align: center; font-size: 28px;">Parking Slots Status</h2>
        <div class="slots" id="slotsContainer"></div>

        <div class="booking-section" id="booking">
            <h2>Book a Parking Slot</h2>
            <p style="color: #666; margin-bottom: 20px; font-size: 16px;">üí≥ Booking Fee: ‚Çπ50 | Pay securely with Razorpay</p>
            <form id="bookingForm">
                <div class="form-group">
                    <label for="plate">Vehicle Number Plate *</label>
                    <input type="text" id="plate" placeholder="e.g., MH 12 AB 1234" required>
                </div>
                <div class="form-group">
                    <label for="name">Owner Name *</label>
                    <input type="text" id="name" placeholder="Enter your name" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" placeholder="Enter phone number" required>
                </div>
                <button type="submit" class="btn" id="bookBtn">Book Slot</button>
                <div id="bookingMessage"></div>
            </form>
        </div>
    </div>

    <script>
        function updateDashboard() {
            fetch('/api/dashboard')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('availableSlots').textContent = data.available;
                    document.getElementById('occupiedSlots').textContent = data.occupied;
                    
                    const slotsContainer = document.getElementById('slotsContainer');
                    slotsContainer.innerHTML = '';
                    data.slots.forEach(slot => {
                        const div = document.createElement('div');
                        div.className = `slot ${slot.status}`;
                        div.innerHTML = `<h3>Slot ${slot.number}</h3><p>${slot.status === 'occupied' ? slot.plate : 'Empty'}</p>`;
                        slotsContainer.appendChild(div);
                    });

                    // Parked cars removed from user dashboard
                });
        }

        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('bookBtn');
            const msg = document.getElementById('bookingMessage');
            
            const plate = document.getElementById('plate').value;
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            
            // Razorpay payment integration (Demo Mode)
            try {
                const options = {
                    key: 'rzp_test_1234567890',
                    amount: 5000, // ‚Çπ50 booking fee (in paise)
                    currency: 'INR',
                    name: 'Smart Parking System',
                    description: 'Parking Slot Booking Fee',
                    image: 'https://cdn-icons-png.flaticon.com/512/3774/3774278.png',
                    handler: function(response) {
                        // Payment successful
                        btn.disabled = true;
                        btn.textContent = 'Processing...';
                        
                        fetch('/api/book', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                plate: plate,
                                name: name,
                                phone: phone,
                                payment_id: response.razorpay_payment_id || 'demo_payment_' + Date.now()
                            })
                        })
                        .then(r => r.json())
                        .then(data => {
                            msg.className = `message ${data.success ? 'success' : 'error'}`;
                            msg.textContent = data.message;
                            if(data.success) {
                                document.getElementById('bookingForm').reset();
                                updateDashboard();
                            }
                        })
                        .finally(() => {
                            btn.disabled = false;
                            btn.textContent = 'Book Slot';
                        });
                    },
                    prefill: {
                        name: name,
                        contact: phone
                    },
                    theme: {
                        color: '#667eea'
                    },
                    modal: {
                        ondismiss: function() {
                            msg.className = 'message error';
                            msg.textContent = 'Payment cancelled';
                        },
                        escape: false,
                        backdropclose: false
                    }
                };
                
                if(typeof Razorpay === 'undefined') {
                    throw new Error('Razorpay not loaded');
                }
                
                const rzp = new Razorpay(options);
                rzp.on('payment.failed', function(response) {
                    msg.className = 'message error';
                    msg.textContent = 'Payment failed: ' + response.error.description;
                });
                rzp.open();
            } catch(error) {
                // Fallback: Direct booking without payment (Demo mode)
                console.log('Razorpay error:', error);
                msg.className = 'message';
                msg.textContent = 'Demo Mode: Processing booking without payment...';
                msg.style.background = '#fff3cd';
                msg.style.color = '#856404';
                
                setTimeout(() => {
                    btn.disabled = true;
                    btn.textContent = 'Processing...';
                    
                    fetch('/api/book', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            plate: plate,
                            name: name,
                            phone: phone,
                            payment_id: 'demo_' + Date.now()
                        })
                    })
                    .then(r => r.json())
                    .then(data => {
                        msg.className = `message ${data.success ? 'success' : 'error'}`;
                        msg.textContent = data.message + ' (Demo Mode - No Payment)';
                        if(data.success) {
                            document.getElementById('bookingForm').reset();
                            updateDashboard();
                        }
                    })
                    .finally(() => {
                        btn.disabled = false;
                        btn.textContent = 'Book Slot';
                    });
                }, 1000);
            }
        });

        updateDashboard();
        setInterval(updateDashboard, 2000); // Update every 2 seconds for better live updates
    </script>
</body>
</html>
